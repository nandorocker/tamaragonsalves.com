---
import { images } from '../data/global';
import { useTranslations, useVideoTranslations, getLangFromUrl } from '../i18n/index';

export interface Props {
  titleKey: string;
  descriptionKey: string;
  videoUrl: string;
  thumbnailUrl: string;
  date: string;
  linkTextKey?: string;
}

const { 
  titleKey,
  descriptionKey,
  videoUrl,
  thumbnailUrl,
  date,
  linkTextKey
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const tv = useVideoTranslations(lang);

// Resolve translation keys
const title = tv(titleKey);
const description = tv(descriptionKey);
const linkText = linkTextKey ? tv(linkTextKey) : tv('videoPublicationCardLinkText');

// Format date once at build time for better performance
const formattedDate = new Date(date).toLocaleDateString('en-US', { 
  year: 'numeric', 
  month: 'long', 
  day: 'numeric' 
});

// Construct image path once
const imagePath = `${images}/${thumbnailUrl}`;
---

<div class="video-card">
  <a href={videoUrl} target="_blank" aria-label={`Watch video: ${title}`} rel="noopener noreferrer">
    <div class="video-thumbnail-container">
      <img src={imagePath} alt={`Video thumbnail for ${title}`} loading="lazy">
    </div>
  </a>
  <time datetime={date} class="video-date">{formattedDate}</time>
  <h5 class="video-title">{title}</h5>
  <p class="video-description">{description}</p>
  <a href={videoUrl} target="_blank" 
     class="video-link icon-after icon-external-link icon-space-sm"
     rel="noopener noreferrer">
    {linkText}
  </a>
</div>